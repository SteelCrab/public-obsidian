# 프로젝트 계획서

## 1. 프로젝트 주제

- 주 주제: Kubernetes 기반 3-Tier 고가용성 시스템 구축
- 세부 주제: 개발자를 위한 올인원 협업 플랫폼 (Gition - Git + Notion)

---

## 2. 요구사항 정의

### 2.1. 시스템 요구사항

- On-Premise VMware 환경에서 Kubernetes 클러스터 구축
- Control Plane(k8s-m): Master 노드
- Worker Node(k8s-n1~n3): 3개 워커 노드
- 인프라 서버: NFS, MySQL, GitLab
- 네트워크: VMware NAT 172.100.100.0/24 대역

### 2.2. 기능 요구사항

- 인증: GitHub OAuth 2.0 로그인
- 저장소 관리: GitHub 저장소 목록 조회 및 Clone
- 브랜치 관리: 브랜치 전환 지원
- 문서 작성: Notion 스타일 블록 에디터
- 코드 탐색: 파일 브라우저

### 2.3. 비기능 요구사항

- 고가용성: MySQL InnoDB Cluster + Pod 복제로 단일 장애점 제거
- 확장성: Deployment replicas 조정으로 수평 확장
- 무중단 배포: Rolling Update + MySQL 자동 Failover
- 보안: OAuth 2.0 + Kubernetes Secret

---

## 3. 프로젝트 목표

### 3.1. 목표 개요

- 고가용성 시스템: MySQL InnoDB Cluster 3노드 + Frontend/Backend 다중 복제
- 자동화 CI/CD: GitHub Actions + GitLab CI 하이브리드 파이프라인
- 장애 자동 복구: MySQL Operator 기반 자동 Failover

### 3.2. 세부 목표

- kubeadm 기반 Kubernetes 클러스터 구축
- Ingress-Nginx + MetalLB 로드밸런싱
- MySQL InnoDB Cluster + Operator 구성
- NFS 서버 + nfs-client-provisioner 배포
- GitHub Actions + GitLab CI 연동
- GitLab Container Registry 활용

---

## 4. 시스템 아키텍처

### 4.1. 클러스터 구성

- Control Plane (k8s-m, 172.100.100.12)
  - API Server, etcd, Scheduler, Controller Manager
- Worker 노드 (k8s-n1~n3, 172.100.100.13~15)
  - Ingress Controller, Frontend, Backend, MySQL Pod 분산 배치

### 4.2. 3-Tier 구성

- Presentation Tier: React SPA (2 replicas)
- Application Tier: FastAPI (3 replicas)
- Data Tier: MySQL InnoDB Cluster (3 nodes)

### 4.3. 네트워크 설계

| 호스트       | IP             | 용도                    |
|--------------|----------------|-------------------------|
| GitLab       | 172.100.100.8  | GitLab CE + Registry    |
| Bastion      | 172.100.100.9  | SSH 게이트웨이          |
| NFS          | 172.100.100.10 | 공유 스토리지           |
| MySQL Master | 172.100.100.11 | 백업용 외부 MySQL       |
| k8s-m        | 172.100.100.12 | Control Plane           |
| k8s-n1       | 172.100.100.13 | Worker Node 1           |
| k8s-n2       | 172.100.100.14 | Worker Node 2           |
| k8s-n3       | 172.100.100.15 | Worker Node 3           |
| MetalLB VIP  | 172.100.100.20 | 외부 트래픽 진입점      |

### 4.4. 데이터 흐름

1. 사용자 → Ingress Controller (gition.local)
2. Ingress → Frontend (React)
3. Frontend → Backend (FastAPI)
4. Backend → MySQL Router (6446 쓰기 / 6447 읽기)
5. InnoDB Cluster (Group Replication 동기화)

---

## 5. 프로젝트 산출물

### 5.1. 구현 파일 목록

- `01-mysql-operator.yaml` - MySQL Operator 설치
- `02-mysql-secret.yaml` - MySQL 인증 정보
- `03-local-storage.yaml` - Local PV StorageClass
- `04-innodb-cluster.yaml` - InnoDB Cluster CR
- `05-app-user.yaml` - DB 스키마 초기화
- `06-mysql-backup.yaml` - 자동 백업 CronJob
- `07-backend-deployment.yaml` - Backend 배포
- `frontend-deployment.yaml` - Frontend 배포
- `ingress.yaml` - Ingress 라우팅

### 5.2. 배포 순서

1. MySQL Operator 설치 (Helm)
2. MySQL Secret 생성
3. Local PV 생성
4. InnoDB Cluster 생성 → ONLINE 대기
5. DB 스키마 초기화
6. Backend 배포
7. Frontend 배포

### 5.3. 검증 방법

- `./check-cluster.sh` - 클러스터 상태 확인
- `kubectl get innodbcluster` - MySQL Cluster 상태
- `kubectl get pods` - Pod 상태
- Primary Pod 삭제 → 자동 Failover 확인