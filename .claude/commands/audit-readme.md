# README 감사 (Audit)

지정된 디렉토리의 README.md와 실제 파일/스크립트 간 불일치를 자동으로 찾아 수정한다.

## 입력

$ARGUMENTS

인자 형식: `<README 경로 또는 디렉토리>` (예: `MZ-CLOUD/GCP/scripts`, `MZ-CLOUD/GCP/scripts/README.md`)

인자가 디렉토리면 그 안의 `README.md`를 대상으로 한다.
인자가 없으면 현재 작업 디렉토리에서 `README.md`를 찾는다.

## 감사 항목

### 1. 파일 구조 트리 검증

README에 파일 트리(```` ``` ````로 감싼 디렉토리 구조)가 있으면:
- `ls` 결과와 비교하여 누락/추가된 파일 찾기
- 하위 디렉토리도 재귀적으로 확인
- 불일치 발견 시 트리를 실제 구조에 맞게 수정

### 2. 함수/변수 테이블 검증

README에 함수나 변수를 나열한 테이블이 있으면:
- 실제 소스 코드(`.sh`, `.py`, `.js` 등)에서 함수/변수 정의를 추출
- 테이블과 1:1 매칭 확인
- 함수 설명이 실제 구현과 일치하는지 확인 (예: `ensure_network`이 Router도 생성하는데 설명에 Router가 빠져 있으면 수정)

### 3. Setup vs Cleanup 비대칭 검증

Setup/Cleanup 스크립트 쌍이 있으면:
- Setup 스크립트의 step 수와 Cleanup 스크립트의 step 수 비교
- 비대칭이 있으면 원인 파악 (예: 버킷 삭제 시 공개설정도 함께 삭제)
- README에 비대칭 원인이 설명되어 있는지 확인, 없으면 추가

### 4. 중복 정보 검증

- 공통 모듈에서 이미 설명한 내용이 개별 모듈 상세에서 반복되는지 확인
- 중복 발견 시 한 줄로 축약 + 참조로 변경 (예: 네트워크 리소스 6줄 → `공유 네트워크 — ensure_network()` 1줄)

### 5. 스크립트 패턴 일관성 검증

같은 역할의 스크립트들이 동일한 패턴을 따르는지 확인:
- Cleanup 스크립트: `done_banner` 뒤 안내 메시지 유무
- 헤더 코멘트 형식
- `set -e`, `trap`, `source` 패턴
- 불일치 발견 시 다수 패턴에 맞게 수정 제안

## 실행

1. README.md 파일을 읽고 구조 파악
2. 같은 디렉토리의 모든 파일/스크립트를 읽기
3. 위 5개 감사 항목을 순서대로 수행
4. 발견된 불일치를 목록으로 정리하여 사용자에게 보고
5. 사용자 확인 후 README 및 스크립트 수정 적용

## 출력 형식

감사 결과를 다음 형식으로 보고:

```
## 감사 결과: <README 경로>

### 불일치 발견 (N건)

| # | 카테고리 | 위치 | 현재 | 수정안 |
|---|---------|------|------|--------|
| 1 | 파일 트리 | README:62 | 파일 3개 | 파일 6개 (mysql 스크립트 누락) |
| 2 | 함수 설명 | README:118 | VPC+서브넷+NAT+방화벽 | VPC+서브넷+Router+NAT+방화벽 |
| ... | ... | ... | ... | ... |

### 일치 확인 (OK)
- 파일 트리: N개 파일 일치
- 함수 테이블: N개 함수 일치
- ...
```

수정 적용 여부는 반드시 사용자에게 확인받은 후 진행한다.
